<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="fontawesome/css/all.min.css" />
    <title>Web Gabut</title>
  </head>
  <body>
    <!-- Navbar -->
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark shadow-lg fixed-top"
    >
      <div class="container">
        <a class="navbar-brand" href="#"> Web Gabut</a>
      </div>
    </nav>
    <!-- Akhir Navbar -->

    <div
      class="container-fluid pt-5 pb-5"
      style="
        background: url(https://media.istockphoto.com/id/1283506462/photo/white-desk-office-with-laptop-smartphone-and-other-work-supplies-with-cup-of-coffee-top-view.jpg?b=1&s=170667a&w=0&k=20&c=Urxk_SoXDdV7ietMtbeOGRtZO54p7ZlbMDLFuJuYtr8=)
          no-repeat center;
        padding-top: 20%;
        padding-bottom: 20%;
        background-size: cover;
      "
    >
      <div class="container pb-5 pt-5">
        <div class="row">
          <h4 class="text-center text-success pb-3">
            <strong>
              Yuk Tulis Sesuatu buat aku, Terserah apapun itu. Saran, kritik
              atau curhat pun juga boleh nanti aku baca
            </strong>
          </h4>
          <div class="col-md-2"></div>
          <div class="col-md-8">
            <!-- Alert -->
            <div
              class="alert alert-success alert-dismissible fade show d-none my-alert"
              role="alert"
            >
              <strong>Terima Kasih!</strong> Pesan Anda Telah Dikirim
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="alert"
                aria-label="Close"
              ></button>
            </div>
            <!-- Akhir Alert -->
            <form name="form-gabut">
              <div class="form-floating pb-3">
                <textarea
                  class="form-control"
                  name="pesan"
                  placeholder="Leave a comment here"
                  id="floatingTextarea2"
                  style="height: 200px"
                  required
                ></textarea>
                <label for="floatingTextarea2">Sampaikan Sesuatu Di Sini</label>
              </div>
              <button type="submit" class="btn btn-primary btn-lg btn-kirim">
                Kirim
              </button>
              <button
                class="btn btn-primary btn-lg btn-loading d-none"
                type="button"
                disabled
              >
                <span
                  class="spinner-border spinner-border-sm"
                  role="status"
                  aria-hidden="true"
                ></span>
                Loading...
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Section untuk menampilkan pesan -->
    <div class="container pt-4 pb-5">
      <h3 class="text-center mb-4">Daftar Pesan</h3>
      <div id="list-pesan">
        <!-- Pesan dari Spreadsheet akan tampil di sini -->
      </div>
      <nav>
        <ul class="pagination justify-content-center" id="pagination"></ul>
      </nav>
    </div>

    <div class="container pt-4 pb-3">
      <div class="row">
        <div class="col-md-4"></div>
        <div class="col-md-4 text-center">
          <h4 class="contact">Contact Me</h4>
          <a href="https://wa.me/085280357433"
            ><i class="fa-brands fa-whatsapp fa-2x m-2"></i
          ></a>
          <a href="https://web.facebook.com/profile.php?id=100008691764112"
            ><i class="fa-brands fa-facebook fa-2x m-2"></i
          ></a>
          <a href="https://instagram.com/ulis_leu_sari?igshid=YmMyMTA2M2Y="
            ><i class="fa-brands fa-instagram fa-2x m-2"></i
          ></a>
        </div>
      </div>
    </div>

    <div class="container-fluid text-center pt-5 pb-5">
      All Rights Reserved Ulis Sayang &copy; 2022
    </div>

    <script>
      const scriptURL =
        "https://script.google.com/macros/s/AKfycbx12WYRFkooHF1xxPnLJjgJqHkC1DwxnG1JV17aWUhPQ-Roj6-abBtYsS1dO4V32LC36Q/exec";

      const form = document.forms["form-gabut"];
      const btnKirim = document.querySelector(".btn-kirim");
      const btnLoading = document.querySelector(".btn-loading");
      const myAlert = document.querySelector(".my-alert");
      const listPesan = document.getElementById("list-pesan");
      const paginationEl = document.getElementById("pagination");

      let currentPage = 1;
      const pageSize = 5; // jumlah pesan per halaman
      let messages = [];

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        btnLoading.classList.toggle("d-none");
        btnKirim.classList.toggle("d-none");
        fetch(scriptURL, { method: "POST", body: new FormData(form) })
          .then((response) => {
            btnLoading.classList.toggle("d-none");
            btnKirim.classList.toggle("d-none");
            myAlert.classList.remove("d-none");
            form.reset();
            loadPesan();
          })
          .catch((error) => console.error("Error!", error.message));
      });

      function renderPagination() {
        const totalPages = Math.ceil(messages.length / pageSize);
        let html = "";

        for (let i = 1; i <= totalPages; i++) {
          html += `<li class="page-item ${
            i === currentPage ? "active" : ""
          }"><a class="page-link" href="#">${i}</a></li>`;
        }
        paginationEl.innerHTML = html;

        // add click event
        const links = paginationEl.querySelectorAll("a");
        links.forEach((link, index) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            currentPage = index + 1;
            displayMessages();
          });
        });
      }

      function displayMessages() {
        const start = (currentPage - 1) * pageSize;
        const end = start + pageSize;
        const pageMessages = messages.slice(start, end);

        if (pageMessages.length === 0) {
          listPesan.innerHTML =
            '<p class="text-center text-muted">Belum ada pesan...</p>';
          return;
        }

        listPesan.innerHTML = "";
        pageMessages.forEach((item) => {
          const pesan = item.pesan ? item.pesan : "(Pesan kosong)";
          const waktu = item.timestamp
            ? new Date(item.timestamp).toLocaleString()
            : "-";
          const card = `
            <div class="card shadow-sm mb-3">
              <div class="card-body">
                <p class="card-text">${pesan}</p>
                <small class="text-muted">${waktu}</small>
              </div>
            </div>`;
          listPesan.innerHTML += card;
        });
      }

      function loadPesan() {
        fetch(scriptURL)
          .then((res) => res.json())
          .then((json) => {
            if (json.result === "success" && json.data.length > 0) {
              messages = json.data.reverse();
              displayMessages();
              renderPagination();
            } else {
              listPesan.innerHTML =
                '<p class="text-center text-muted">Belum ada pesan...</p>';
              paginationEl.innerHTML = "";
            }
          })
          .catch((err) => {
            console.error("Gagal ambil data:", err);
            listPesan.innerHTML =
              '<p class="text-center text-danger">Error mengambil data!</p>';
          });
      }

      loadPesan();
    </script>

    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"></script>

    <script>
      gsap.from(".text-success", {
        duration: 1.5,
        y: "100%",
        opacity: 0,
        ease: "bounce.out",
      });
      gsap.from(".form-floating", {
        duration: 2.5,
        delay: 1,
        ease: "back.out(1.7)",
        y: 100,
        opacity: 0,
      });
      gsap.from(".btn-kirim", {
        duration: 2.5,
        delay: 1,
        ease: "back.out(1.7)",
        x: -50,
        opacity: 0,
      });
      gsap.from(".navbar", {
        duration: 1.5,
        y: "-100%",
        opacity: 0,
        ease: "bounce.out",
      });
      gsap.from(".contact", {
        duration: 4,
        delay: 2,
        x: -50,
        opacity: 0,
        ease: "elastic.out(1, 0.3)",
      });
      gsap.from(".fa-whatsapp", {
        duration: 4,
        delay: 2.5,
        y: 30,
        opacity: 0,
        ease: "elastic.out(1, 0.3)",
      });
      gsap.from(".fa-facebook", {
        duration: 4,
        delay: 2.7,
        y: 30,
        opacity: 0,
        ease: "elastic.out(1, 0.3)",
      });
      gsap.from(".fa-instagram", {
        duration: 4,
        delay: 3,
        y: 30,
        opacity: 0,
        ease: "elastic.out(1, 0.3)",
      });
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
